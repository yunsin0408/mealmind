{% extends 'home/base.html' %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Admin Dashboard — User List</h2>
    <form class="d-flex" method="get" action="{{ url_for('routes.admin_dashboard') }}">
        <input name="q" class="form-control form-control-sm me-2" placeholder="Search users (username or email)" value="{{ q }}">
        <button class="btn btn-sm btn-outline-primary" type="submit">Search</button>
    </form>
</div>

<div class="table-responsive">
    <table class="table table-sm table-striped align-middle">
        <thead>
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Confirmed</th>
                <th>Admin</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>{% if u.is_confirmed %}<span class="text-success">Yes</span>{% else %}<span class="text-muted">No</span>{% endif %}</td>
                <td>{% if u.is_admin %}<span class="badge bg-success">Admin</span>{% else %}<span class="text-muted">User</span>{% endif %}</td>
                <td>{{ u.created_on.strftime('%Y-%m-%d') if u.created_on else '' }}</td>
                <td>
                    <div class="d-flex gap-1">
                        <form method="post" action="{{ url_for('routes.admin_user_action', user_id=u.id) }}">
                            <input type="hidden" name="action" value="toggle_confirm">
                            <button class="btn btn-sm btn-outline-{{ 'secondary' if u.is_confirmed else 'success' }}" type="submit">{{ 'Unconfirm' if u.is_confirmed else 'Confirm' }}</button>
                        </form>

                        <form method="post" action="{{ url_for('routes.admin_user_action', user_id=u.id) }}">
                            <input type="hidden" name="action" value="toggle_admin">
                            <button class="btn btn-sm btn-outline-{{ 'danger' if u.is_admin else 'primary' }}" type="submit">{{ 'Demote' if u.is_admin else 'Promote' }}</button>
                        </form>

                        <form method="post" action="{{ url_for('routes.admin_user_action', user_id=u.id) }}" onsubmit="return confirm('確定要刪除此使用者嗎？');">
                            <input type="hidden" name="action" value="delete">
                            <button class="btn btn-sm btn-outline-danger" type="submit">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
